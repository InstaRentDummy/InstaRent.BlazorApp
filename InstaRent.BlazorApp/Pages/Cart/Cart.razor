@page "/cart"
@using Blazored.LocalStorage
@using InstaRent.BlazorApp.Services.Catalog
@using InstaRent.BlazorApp.Shared.Users
@using InstaRent.Cart.Services
@inject ILocalStorageService localStorage
@inject ICatalogService catalogService

<h3>Shopping Cart</h3>
@if (cartDto == null || cartDto.Items.Count <= 0)
{
    <span>You have no items in your cart.</span>
}
else
{
    <div>
        @foreach (var item in cartDto.Items)
        {
            <div class="card-group">
                <div class="card-img">
                    <img src="@item.ImageUrls[0]" width="50" height="50" class="img-thumbnail" />
                </div>
                <div class="card-body">
                    <h5>@item.BagName</h5>
                    <span>From @item.StartDate</span>
                    <span>To @item.EndDate</span><br />
                    <button class="btn-delete" @onclick="@(() => DeleteItem(item))">Delete</button>
                </div>
                <div >$@item.price</div>
            </div>
        }
        <div class="item-price">
            Total (@cartDto.Items.Count): $@cartDto.TotalPrice
        </div>
        <div style="text-align: center; margin-top: 10px;">
            <button class="btn btn-primary btn-lg" @onclick="PlaceOrder">Place Order</button>
        </div>
    </div>
}

@code {
    CartDto cartDto;
    bool orderPlaced = false;
    UserInfoDto localUser = new();

    protected override async Task OnInitializedAsync()
    {
        localUser = await localStorage.GetItemAsync<UserInfoDto>("user");
        cartDto = await catalogService.GetCartItembyUserIdAsync(localUser.Email);
    }

    private async Task DeleteItem(CartItemDto item)
    {
        await catalogService.RemoveItemFromCartAsync(item.BagId.ToString(), localUser.Email);
        //cartItems = await CartService.GetCartItems();
    }

    private async Task PlaceOrder()
    {
        //orderPlaced = true;
        //await CartService.EmptyCart();
    }
}

